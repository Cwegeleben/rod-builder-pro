{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "Typecheck and build",
      "type": "shell",
      "command": "npm run -s typecheck && npm run -s build",
      "group": "build"
    },
    {
      "label": "Build app",
      "type": "shell",
      "command": "npm run -s build",
      "problemMatcher": ["$tsc"],
      "group": "build"
    },
    {
      "label": "Prisma generate",
      "type": "shell",
      "command": "npm run -s setup"
    },
    {
      "label": "Prisma migrate dev",
      "type": "shell",
      "command": "npx prisma migrate dev --name importer-v2-schema --create-only"
    },
    {
      "label": "Typecheck and build",
      "type": "shell",
      "command": "npm run -s typecheck && npm run -s build",
      "group": "build"
    },
    {
      "label": "Prisma migrate dev apply",
      "type": "shell",
      "command": "npx prisma migrate dev --name importer-v2-schema"
    },
    {
      "label": "Run unit tests (importer version)",
      "type": "shell",
      "command": "npm run -s test:unit -- -t ensureImporterVersion"
    },
    {
      "label": "Typecheck and build (final)",
      "type": "shell",
      "command": "npm run -s typecheck && npm run -s build",
      "group": "build"
    },
    {
      "label": "Run unit tests ensureImporterVersion",
      "type": "shell",
      "command": "npm run -s test:unit -- -t ensureImporterVersion"
    },
    {
      "label": "Generate Prisma client (again)",
      "type": "shell",
      "command": "npm run -s setup"
    },
    {
      "label": "Run unit tests ensureImporterVersion",
      "type": "shell",
      "command": "npm run -s test:unit -- -t ensureImporterVersion"
    },
    {
      "label": "Install new dependencies",
      "type": "shell",
      "command": "npm install",
      "group": "build"
    },
    {
      "label": "Typecheck new importer code",
      "type": "shell",
      "command": "npm run -s typecheck"
    },
    {
      "label": "Prisma migrate deploy after PartStaging unique index",
      "type": "shell",
      "command": "npx prisma migrate dev --name partstaging-composite-unique",
      "group": "build"
    },
    {
      "label": "Run PartStaging dedupe",
      "type": "shell",
      "command": "node scripts/migrate/dedupe-partstaging.mjs"
    },
    {
      "label": "Re-run migrate for PartStaging unique",
      "type": "shell",
      "command": "npx prisma migrate dev --name partstaging-composite-unique"
    },
    {
      "label": "Run cleanup + migrate checklist",
      "type": "shell",
      "command": "npm run -s db:cleanup:partstaging && npm run -s setup && npx prisma migrate deploy"
    },
    {
      "label": "Smoke run 1",
      "type": "shell",
      "command": "BATSON_SEEDS=\"https://batsonenterprises.com/collections/blanks\" npm run -s importer:smoke"
    },
    {
      "label": "Smoke run 2",
      "type": "shell",
      "command": "BATSON_SEEDS=\"https://batsonenterprises.com/collections/blanks\" npm run -s importer:smoke"
    },
    {
      "label": "Install tsx if missing",
      "type": "shell",
      "command": "npm install --no-audit --no-fund --silent"
    },
    {
      "label": "Cleanup + migrate deploy",
      "type": "shell",
      "command": "npm run -s db:cleanup:partstaging && npm run -s setup && npx prisma migrate deploy"
    },
    {
      "label": "Smoke run 1 (with tsx)",
      "type": "shell",
      "command": "BATSON_SEEDS=\"https://batsonenterprises.com/collections/blanks\" npm run -s importer:smoke"
    },
    {
      "label": "Smoke run 2 (with tsx)",
      "type": "shell",
      "command": "BATSON_SEEDS=\"https://batsonenterprises.com/collections/blanks\" npm run -s importer:smoke"
    },
    {
      "label": "Install tools and browsers",
      "type": "shell",
      "command": "npm install --no-audit --no-fund --silent && pnpm exec playwright install chromium"
    },
    {
      "label": "One-pass make it green",
      "type": "shell",
      "command": "pnpm exec tsx --version && pnpm exec prisma --version && pnpm prisma generate && pnpm db:check:partstaging && pnpm db:cleanup:partstaging && pnpm db:migrate:deploy && BATSON_SEEDS=\"https://batsonenterprises.com/collections/blanks\" pnpm importer:smoke && BATSON_SEEDS=\"https://batsonenterprises.com/collections/blanks\" pnpm importer:smoke"
    },
    {
      "label": "Typecheck importer normalization and diff",
      "type": "shell",
      "command": "npm run -s typecheck"
    },
    {
      "label": "Typecheck and build (final)",
      "type": "shell",
      "command": "npm run -s typecheck && npm run -s build",
      "group": "build"
    },
    {
      "label": "Typecheck importer normalization and diff",
      "type": "shell",
      "command": "npm run -s typecheck"
    },
    {
      "label": "Typecheck and build",
      "type": "shell",
      "command": "npm run -s typecheck && npm run -s build",
      "group": "build"
    },
    {
      "label": "Typecheck and build (final)",
      "type": "shell",
      "command": "npm run -s typecheck && npm run -s build",
      "group": "build"
    },
    {
      "label": "Typecheck importer normalization and diff",
      "type": "shell",
      "command": "npm run -s typecheck"
    },
    {
      "label": "Typecheck importer normalization and diff",
      "type": "shell",
      "command": "npm run -s typecheck"
    },
    {
      "label": "Typecheck and build (final)",
      "type": "shell",
      "command": "npm run -s typecheck && npm run -s build",
      "group": "build"
    },
    {
      "label": "Typecheck and build",
      "type": "shell",
      "command": "npm run -s typecheck && npm run -s build",
      "group": "build"
    },
    {
      "label": "Run new e2e (imports progress)",
      "type": "shell",
      "command": "pnpm exec playwright test tests/e2e/importer.progress.inline.spec.ts",
      "group": "test"
    },
    {
      "label": "Run new e2e (imports queueing)",
      "type": "shell",
      "command": "pnpm exec playwright test tests/e2e/importer.queueing.inline.spec.ts",
      "group": "test"
    },
    {
      "label": "Run new e2e (save & crawl)",
      "type": "shell",
      "command": "pnpm exec playwright test tests/e2e/importer.saveAndCrawl.inline.spec.ts",
      "group": "test"
    },
    {
      "label": "Run unit tests",
      "type": "shell",
      "command": "npm run -s test:unit"
    },
    {
      "label": "Typecheck new importer code",
      "type": "shell",
      "command": "npm run -s typecheck"
    },
    {
      "label": "Run unit tests (importer version)",
      "type": "shell",
      "command": "npm run -s test:unit -- -t header|crawl|runOptions|headerSkip"
    },
    {
      "label": "Typecheck and build (final)",
      "type": "shell",
      "command": "npm run -s typecheck && npm run -s build"
    },
    {
      "label": "Typecheck and build (final)",
      "type": "shell",
      "command": "npm run -s typecheck && npm run -s build",
      "group": "build"
    },
    {
      "label": "Run e2e: schedule vs settings",
      "type": "shell",
      "command": "pnpm exec playwright test tests/e2e/importer.schedule-vs-settings.spec.ts",
      "group": "test"
    },
    {
      "label": "Deploy Shopify (prod)",
      "type": "shell",
      "command": "npm run -s deploy:shopify:prod",
      "group": "build"
    },
    {
      "label": "Deploy Shopify (staging)",
      "type": "shell",
      "command": "npm run -s deploy:shopify:staging",
      "group": "build"
    },
    {
      "label": "Deploy Fly (prod)",
      "type": "shell",
      "command": "npm run -s deploy:fly:prod",
      "group": "build"
    },
    {
      "label": "Deploy Fly (staging)",
      "type": "shell",
      "command": "npm run -s deploy:fly:staging",
      "group": "build"
    },
    {
      "label": "Release (prod)",
      "type": "shell",
      "command": "npm run -s release:prod",
      "group": "build"
    },
    {
      "label": "Release (staging)",
      "type": "shell",
      "command": "npm run -s release:staging",
      "group": "build"
    }
  ]
}
